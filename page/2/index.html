<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qianqiuzhifeng.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="随堂笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="浅秋之枫">
<meta property="og:url" content="https://qianqiuzhifeng.github.io/page/2/index.html">
<meta property="og:site_name" content="浅秋之枫">
<meta property="og:description" content="随堂笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="浅秋之枫">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://qianqiuzhifeng.github.io/page/2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>浅秋之枫</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">浅秋之枫</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">浅秋之枫</p>
  <div class="site-description" itemprop="description">随堂笔记</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/09/k8s-component-api-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/09/k8s-component-api-server/" class="post-title-link" itemprop="url">k8s-tool-api-server</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-09 15:17:08" itemprop="dateCreated datePublished" datetime="2020-12-09T15:17:08+08:00">2020-12-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-10 09:57:53" itemprop="dateModified" datetime="2020-12-10T09:57:53+08:00">2020-12-10</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>K8s API server 验证和配置 API 对象的数据，这些对象包括 pods、服务、复制控制器等。API server 为 REST 操作提供服务，并为集群提供共享状态前端，所有其他组件都通过该状态进行交互。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kube-apiserver [flags]</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">类型</th>
<th align="left">默认值</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">–add-dir-header</td>
<td align="left">boolean</td>
<td align="left"></td>
<td align="left">如果为 true，将增加文件夹到日志消息的头里</td>
</tr>
<tr>
<td align="left">–advertise-address</td>
<td align="left">ip</td>
<td align="left"></td>
<td align="left">向集群成员发布 apiserver 的 IP 地址。集群的其他节点必须可以访问该地址。如果为空，则使用–bind-address。如果未指定–bind-address，将使用主机的默认接口</td>
</tr>
<tr>
<td align="left">–allow-privileged</td>
<td align="left">boolean</td>
<td align="left">false</td>
<td align="left">如果为 true,表示允许特权容器。默认为 false</td>
</tr>
<tr>
<td align="left">–anonymous-auth</td>
<td align="left">boolean</td>
<td align="left">true</td>
<td align="left">是否允许匿名访问 API server 的安全接口。未被其他身份验证方法拒绝的请求被视为匿名请求。匿名请求的用户名为 system:Anonymous，组名为 system:unauthenticated。默认为 true</td>
</tr>
<tr>
<td align="left">–api-audiences</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">API 的标识符。service account 令牌身份验证器将验证针对 API 使用的令牌至少绑定到其中一个受众。如果配置了–service-account-issuer 标志而未配置此标志，则此字段默认为包含发行者 URL 的单个元素列表。</td>
</tr>
<tr>
<td align="left">–apiserver-count</td>
<td align="left">int</td>
<td align="left">1</td>
<td align="left">集群中运行的 apiservers 数量必须为正数。(在–endpoint-reconciler-type=master-count 启用时使用)，默认为 1</td>
</tr>
<tr>
<td align="left">–audit-log-batch-buffer-size</td>
<td align="left">int</td>
<td align="left">10000</td>
<td align="left">在批处理和写入之前存储事件的缓冲区的大小。只在批处理模式下使用，默认为 10000</td>
</tr>
<tr>
<td align="left">–audit-log-batch-max-size</td>
<td align="left">int</td>
<td align="left">1</td>
<td align="left">批处理数量的最大值。只在批处理模式下使用，默认为 1</td>
</tr>
<tr>
<td align="left">–audit-log-batch-max-wait</td>
<td align="left">duration</td>
<td align="left"></td>
<td align="left">强制写入尚未达到最大大小的批处理之前等待的时间。只在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-log-batch-throttle-burst</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">如果以前没有使用 ThrottleQPS，则同时发送的最大请求数。只在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-log-batch-throttle-enable</td>
<td align="left">boolean</td>
<td align="left"></td>
<td align="left">是否启用批处理节流。只在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-log-batch-throttle-qps</td>
<td align="left">float32</td>
<td align="left"></td>
<td align="left">每秒最大平均批处理数。只在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-log-compress</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果设置，则使用 gzip 压缩轮换的日志文件。</td>
</tr>
<tr>
<td align="left">–audit-log-format</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">保存审计日志的格式。“legacy”表示每个事件的一行文本格式。“json”表示结构化 json 格式。已知的格式是 legacy 和 json。</td>
</tr>
<tr>
<td align="left">–audit-log-maxage</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">根据文件名中编码的时间戳保留旧审计日志文件的最大天数。</td>
</tr>
<tr>
<td align="left">–audit-log-maxbackup</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">要保留的旧审计日志文件的最大数目。</td>
</tr>
<tr>
<td align="left">–audit-log-maxsize</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">轮换审计日志文件之前的最大大小(以兆字节为单位)。</td>
</tr>
<tr>
<td align="left">–audit-log-mode</td>
<td align="left">string</td>
<td align="left">Blocking</td>
<td align="left">发送审计事件的策略。Blocking 表示发送事件应该阻塞服务器响应。Batch 导致后端异步地缓冲和编写事件。已知的模式是 Batch、Blocking、blocking-strict。默认是 Blocking</td>
</tr>
<tr>
<td align="left">–audit-log-path</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果设置，所有进入 apiserver 的请求都将被记录到该文件中。“-”的意思是标准输出。</td>
</tr>
<tr>
<td align="left">–audit-log-truncate-enabled</td>
<td align="left">boolean</td>
<td align="left"></td>
<td align="left">是否启用了事件和批处理截断</td>
</tr>
<tr>
<td align="left">–audit-log-truncate-max-batch-size</td>
<td align="left">int</td>
<td align="left">10485760</td>
<td align="left">发送到基础后端批处理的最大大小。实际的序列化大小可能要大数百个字节。如果一个批超过这个限制，它将被分割成几个更小的批。默认值为 10485760</td>
</tr>
<tr>
<td align="left">–audit-log-truncate-max-event-size</td>
<td align="left">int</td>
<td align="left">102400</td>
<td align="left">发送到底层后端审计事件的最大大小。如果事件的大小大于这个数字，则删除第一个请求和响应，如果这不能充分减少大小，则丢弃事件。默认值为 102400</td>
</tr>
<tr>
<td align="left">–audit-log-version</td>
<td align="left">string</td>
<td align="left">audit.k8s.io/v1</td>
<td align="left">用于序列化写入日志的审计事件的 API 组和版本。默认为 audit.k8s.io/v1</td>
</tr>
<tr>
<td align="left">–audit-policy-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">定义审计策略的文件地址</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-buffer-size</td>
<td align="left">int</td>
<td align="left">10000</td>
<td align="left">在批处理和写入之前存储事件的缓冲区的大小。只在批处理模式下使用。默认为 10000</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-max-size</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">批处理的最大大小。只在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-max-size</td>
<td align="left">int</td>
<td align="left">400</td>
<td align="left">批次的最大大小。 仅在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-max-wait</td>
<td align="left">duration</td>
<td align="left">默认值：30s</td>
<td align="left">强制写入尚未达到最大大小的批处理之前要等待的时间。 仅在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-throttle-burst</td>
<td align="left">int</td>
<td align="left">默认值：15</td>
<td align="left">如果之前未使用 ThrottleQPS，则同时发送的最大请求数。 仅在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-throttle-enable</td>
<td align="left">boolean</td>
<td align="left">默认值：true</td>
<td align="left">是否启用了批量限制。 仅在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-webhook-batch-throttle-qps</td>
<td align="left">float32</td>
<td align="left">默认值：10</td>
<td align="left">每秒的最大平均批次数。 仅在批处理模式下使用。</td>
</tr>
<tr>
<td align="left">–audit-webhook-config-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">定义审计 webhook 配置的 kubeconfig 格式文件的路径。</td>
</tr>
<tr>
<td align="left">–audit-webhook-initial-backoff</td>
<td align="left">duration</td>
<td align="left">默认值：10s</td>
<td align="left">重试第一个失败的请求之前要等待的时间。</td>
</tr>
<tr>
<td align="left">–audit-webhook-mode</td>
<td align="left">string</td>
<td align="left">默认值：”batch”</td>
<td align="left">发送审计事件的策略。 阻止（Blocking）表示发送事件应阻止服务器响应。 批处理导致后端异步缓冲和写入事件。 已知的模式是批处理（batch），阻塞（blocking），严格阻塞（blocking-strict）。</td>
</tr>
<tr>
<td align="left">–audit-webhook-truncate-enabled</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">是否启用事件和批处理截断。</td>
</tr>
<tr>
<td align="left">–audit-webhook-truncate-max-batch-size</td>
<td align="left">int</td>
<td align="left">默认值：10485760</td>
<td align="left">发送到下层后端的批次的最大数据量。 实际的序列化大小可能会增加数百个字节。 如果一个批次超出此限制，则将其分成几个较小的批次。</td>
</tr>
<tr>
<td align="left">–audit-webhook-truncate-max-event-size</td>
<td align="left">int</td>
<td align="left">默认值：102400</td>
<td align="left">发送到下层后端的批次的最大数据量。 如果事件的大小大于此数字，则将删除第一个请求和响应， 并且如果事件和事件的大小没有足够减小，则将丢弃事件。</td>
</tr>
<tr>
<td align="left">–audit-webhook-version</td>
<td align="left">string</td>
<td align="left">默认值：”audit.k8s.io/v1”</td>
<td align="left">用于序列化写入 Webhook 的审计事件的 API 组和版本。</td>
</tr>
<tr>
<td align="left">–authentication-token-webhook-cache-ttl</td>
<td align="left">duration</td>
<td align="left">默认值：2m0s</td>
<td align="left">来自 Webhook 令牌身份验证器的缓存响应的持续时间。</td>
</tr>
<tr>
<td align="left">–authentication-token-webhook-config-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含 Webhook 配置的文件，用于以 kubeconfig 格式进行令牌认证。 API 服务器将查询远程服务，以对持有者令牌进行身份验证。</td>
</tr>
<tr>
<td align="left">–authentication-token-webhook-version</td>
<td align="left">string</td>
<td align="left">默认值：”v1beta1”</td>
<td align="left">与 Webhook 之间交换 authentication.k8s.io TokenReview 时使用的 API 版本。</td>
</tr>
<tr>
<td align="left">–authorization-mode</td>
<td align="left">stringSlice</td>
<td align="left">默认值：[AlwaysAllow]</td>
<td align="left">在安全端口上进行鉴权的插件的顺序列表。 逗号分隔的列表：AlwaysAllow,AlwaysDeny,ABAC,Webhook,RBAC,Node。</td>
</tr>
<tr>
<td align="left">–authorization-policy-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含安全策略的文件，其内容为分行 JSON 格式， 在安全端口上与 –authorization-mode=ABAC 一起使用。</td>
</tr>
<tr>
<td align="left">–authorization-webhook-cache-authorized-ttl</td>
<td align="left">duration</td>
<td align="left">默认值：5m0s</td>
<td align="left">缓存来自 Webhook 鉴权组件的 “授权（authorized）” 响应的持续时间。</td>
</tr>
<tr>
<td align="left">–authorization-webhook-cache-unauthorized-ttl</td>
<td align="left">duration</td>
<td align="left">默认值：30s</td>
<td align="left">缓存来自 Webhook 鉴权模块的 “未授权（unauthorized）” 响应的持续时间。</td>
</tr>
<tr>
<td align="left">–authorization-webhook-config-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含 Webhook 配置的文件，其格式为 kubeconfig， 与 –authorization-mode=Webhook 一起使用。 API 服务器将查询远程服务，以对 API 服务器的安全端口的访问执行鉴权。</td>
</tr>
<tr>
<td align="left">–authorization-webhook-version</td>
<td align="left">string</td>
<td align="left">默认值：”v1beta1”</td>
<td align="left">与 Webhook 之间交换 authorization.k8s.io SubjectAccessReview 时使用的 API 版本。</td>
</tr>
<tr>
<td align="left">–azure-container-registry-config</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含 Azure 容器仓库配置信息的文件的路径。</td>
</tr>
<tr>
<td align="left">–bind-address</td>
<td align="left">ip</td>
<td align="left">默认值：0.0.0.0</td>
<td align="left">监听 –secure-port 端口的 IP 地址。 集群的其余部分以及 CLI/web 客户端必须可以访问关联的接口。 如果为空白或未指定地址（0.0.0.0 或 ::），则将使用所有接口。</td>
</tr>
<tr>
<td align="left">–cert-dir</td>
<td align="left">string</td>
<td align="left">默认值：”/var/run/kubernetes”</td>
<td align="left">TLS 证书所在的目录。 如果提供了 –tls-cert-file 和 –tls-private-key-file，则将忽略此标志。</td>
</tr>
<tr>
<td align="left">–client-ca-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果已设置，则使用与客户端证书的 CommonName 对应的标识对任何出示由 client-ca 文件中的授权机构之一签名的客户端证书的请求进行身份验证。</td>
</tr>
<tr>
<td align="left">–cloud-config</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">云厂商配置文件的路径。 空字符串表示无配置文件。</td>
</tr>
<tr>
<td align="left">–cloud-provider</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">云服务提供商。 空字符串表示没有云厂商。</td>
</tr>
<tr>
<td align="left">–cloud-provider-gce-l7lb-src-cidrs</td>
<td align="left">cidrs</td>
<td align="left">默认值：130.211.0.0/22,35.191.0.0/16</td>
<td align="left">在 GCE 防火墙中打开 CIDR，以进行 L7 LB 流量代理和运行状况检查</td>
</tr>
<tr>
<td align="left">–contention-profiling</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">如果启用了性能分析，则启用锁争用性能分析</td>
</tr>
<tr>
<td align="left">–cors-allowed-origins</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">CORS 允许的来源清单，以逗号分隔。 允许的来源可以是支持子域匹配的正则表达式。 如果此列表为空，则不会启用 CORS。</td>
</tr>
<tr>
<td align="left">–default-not-ready-toleration-seconds</td>
<td align="left">int</td>
<td align="left">默认值：300</td>
<td align="left">标明 notReady:NoExecute 的 tolerationSeconds， 默认情况下将其添加到尚未具有此容忍度的每个 pod 中。</td>
</tr>
<tr>
<td align="left">–default-unreachable-toleration-seconds</td>
<td align="left">int</td>
<td align="left">默认值：300</td>
<td align="left">标明 unreachable:NoExecute 的 tolerationSeconds， 默认情况下将其添加到尚未具有此容忍度的每个 pod 中。</td>
</tr>
<tr>
<td align="left">–default-watch-cache-size</td>
<td align="left">int</td>
<td align="left">默认值：100</td>
<td align="left">默认监听（watch）缓存大小。 如果为零，则将为没有设置默认监视大小的资源禁用监视缓存。</td>
</tr>
<tr>
<td align="left">–delete-collection-workers</td>
<td align="left">int</td>
<td align="left">默认值：1</td>
<td align="left">为 DeleteCollection 调用而产生的工作程序数。 这些用于加速名字空间清理。</td>
</tr>
<tr>
<td align="left">–disable-admission-plugins</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">尽管位于默认启用的插件列表中（NamespaceLifecycle、LimitRanger、ServiceAccount、TaintNodesByCondition、Priority、DefaultTolerationSeconds、DefaultStorageClass、StorageObjectInUseProtection、PersistentVolumeClaimResize、RuntimeClass、CertificateApproval、CertificateSigning、CertificateSubjectRestriction、DefaultIngressClass、MutatingAdmissionWebhook、ValidatingAdmissionWebhook、ResourceQuota）仍须被禁用的插件。取值为逗号分隔的准入插件列表：AlwaysAdmit, AlwaysDeny, AlwaysPullImages, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, DefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, DenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, RuntimeClass, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, TaintNodesByCondition, ValidatingAdmissionWebhook。</td>
</tr>
<tr>
<td align="left">该标志中插件的顺序无关紧要。</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">–egress-selector-config-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">带有 apiserver 出站选择器配置的文件。</td>
</tr>
<tr>
<td align="left">–enable-admission-plugins</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">除了默认启用的插件（NamespaceLifecycle、LimitRanger、ServiceAccount、TaintNodesByCondition、Priority、DefaultTolerationSeconds、DefaultStorageClass、StorageObjectInUseProtection、PersistentVolumeClaimResize、RuntimeClass、CertificateApproval、CertificateSigning、CertificateSubjectRestriction、DefaultIngressClass、MutatingAdmissionWebhook、ValidatingAdmissionWebhook、ResourceQuota）之外要启用的插件。取值为逗号分隔的准入插件列表：AlwaysAdmit, AlwaysDeny, AlwaysPullImages, CertificateApproval, CertificateSigning, CertificateSubjectRestriction, DefaultIngressClass, DefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, DenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, RuntimeClass, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, TaintNodesByCondition, ValidatingAdmissionWebhook</td>
</tr>
<tr>
<td align="left">该标志中插件的顺序无关紧要。</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">–enable-aggregator-routing</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">允许聚合器将请求路由到端点 IP 而非集群 IP。</td>
</tr>
<tr>
<td align="left">–enable-bootstrap-token-auth</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">启用以允许将 “kube-system” 名字空间中类型为 “bootstrap.kubernetes.io/token” 的 Secret 用于 TLS 引导身份验证。</td>
</tr>
<tr>
<td align="left">–enable-garbage-collector</td>
<td align="left"></td>
<td align="left">默认值：true</td>
<td align="left">启用通用垃圾收集器。 必须与 kube-controller-manager 的相应标志同步。</td>
</tr>
<tr>
<td align="left">–enable-priority-and-fairness</td>
<td align="left"></td>
<td align="left">默认值：true</td>
<td align="left">如果为 true 且启用了 APIPriorityAndFairness 特性门控， 请使用增强的处理程序替换 max-in-flight 处理程序， 以便根据优先级和公平性完成排队和调度。</td>
</tr>
<tr>
<td align="left">–encryption-provider-config</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含加密提供程序配置信息的文件，用在 etcd 中所存储的 Secret 上。</td>
</tr>
<tr>
<td align="left">–endpoint-reconciler-type</td>
<td align="left">string</td>
<td align="left">默认值：”lease”</td>
<td align="left">使用端点协调器（master-count, lease, none）</td>
</tr>
<tr>
<td align="left">–etcd-cafile</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">用于保护 etcd 通信的 SSL 证书颁发机构文件。</td>
</tr>
<tr>
<td align="left">–etcd-certfile</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">用于保护 etcd 通信的 SSL 证书文件。</td>
</tr>
<tr>
<td align="left">–etcd-compaction-interval</td>
<td align="left">duration</td>
<td align="left">默认值：5m0s</td>
<td align="left">压缩请求的间隔。 如果为 0，则禁用来自 apiserver 的压缩请求。</td>
</tr>
<tr>
<td align="left">–etcd-count-metric-poll-period</td>
<td align="left">duration</td>
<td align="left">默认值：1m0s</td>
<td align="left">针对每种类型的资源数量轮询 etcd 的频率。 0 禁用度量值收集。</td>
</tr>
<tr>
<td align="left">–etcd-db-metric-poll-interval</td>
<td align="left">duration</td>
<td align="left">默认值：30s</td>
<td align="left">轮询 etcd 和更新度量值的请求间隔。 0 禁用度量值收集</td>
</tr>
<tr>
<td align="left">–etcd-keyfile</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">用于保护 etcd 通信的 SSL 密钥文件。</td>
</tr>
<tr>
<td align="left">–etcd-prefix</td>
<td align="left">string</td>
<td align="left">默认值：”/registry”</td>
<td align="left">要在 etcd 中所有资源路径之前添加的前缀。</td>
</tr>
<tr>
<td align="left">–etcd-servers</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">要连接的 etcd 服务器列表（scheme://ip:port），以逗号分隔。</td>
</tr>
<tr>
<td align="left">–etcd-servers-overrides</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">etcd 服务器针对每个资源的重载设置，以逗号分隔。 单个替代格式：组/资源#服务器（group/resource#servers），其中服务器是 URL，以分号分隔。</td>
</tr>
<tr>
<td align="left">–event-ttl</td>
<td align="left">duration</td>
<td align="left">默认值：1h0m0s</td>
<td align="left">事件的保留时长。</td>
</tr>
<tr>
<td align="left">–external-hostname</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">为此主机生成外部化 URL 时要使用的主机名（例如 Swagger API 文档或 OpenID 发现）。</td>
</tr>
<tr>
<td align="left">–feature-gates</td>
<td align="left">mapStringBool</td>
<td align="left"></td>
<td align="left">一组 key=value 对，用来描述测试性/试验性功能的特性门控（Feature Gate）。可选项有： 参见官方文档</td>
</tr>
<tr>
<td align="left">–goaway-chance</td>
<td align="left">float</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">为防止 HTTP/2 客户端卡在单个 apiserver 上，可启用随机关闭连接（GOAWAY）。 客户端的其他运行中请求将不会受到影响，并且客户端将重新连接， 可能会在再次通过负载平衡器后登陆到其他 apiserver 上。 此参数设置将发送 GOAWAY 的请求的比例。 具有单个 apiserver 或不使用负载平衡器的群集不应启用此功能。 最小值为 0（关闭），最大值为 .02（1/50 请求）； 建议使用 .001（1/1000）。</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">-h, –help</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">kube-apiserver 的帮助命令</td>
</tr>
<tr>
<td align="left">–http2-max-streams-per-connection</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">服务器为客户端提供的 HTTP/2 连接中最大流数的限制。 零表示使用 golang 的默认值。</td>
</tr>
<tr>
<td align="left">–kubelet-certificate-authority</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">证书颁发机构的证书文件的路径。</td>
</tr>
<tr>
<td align="left">–kubelet-client-certificate</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">TLS 的客户端证书文件的路径。</td>
</tr>
<tr>
<td align="left">–kubelet-client-key</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">TLS 客户端密钥文件的路径。</td>
</tr>
<tr>
<td align="left">–kubelet-preferred-address-types</td>
<td align="left">stringSlice</td>
<td align="left">默认值：[Hostname,InternalDNS,InternalIP,ExternalDNS,ExternalIP]</td>
<td align="left">用于 kubelet 连接的首选 NodeAddressTypes 列表。</td>
</tr>
<tr>
<td align="left">–kubelet-timeout</td>
<td align="left">duration</td>
<td align="left">默认值：5s</td>
<td align="left">kubelet 操作超时时间。</td>
</tr>
<tr>
<td align="left">–kubernetes-service-node-port</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">如果非零，那么 Kubernetes 主服务（由 apiserver 创建/维护）将是 NodePort 类型，使用它作为端口的值。 如果为零，则 Kubernetes 主服务将为 ClusterIP 类型。</td>
</tr>
<tr>
<td align="left">–livez-grace-period</td>
<td align="left">duration</td>
<td align="left"></td>
<td align="left">此选项代表 apiserver 完成启动序列并生效所需的最长时间。 从 apiserver 的启动时间到这段时间为止， /livez 将假定未完成的启动后钩子将成功完成，因此返回 true。当日志机制执行到’文件 :N’时，生成堆栈跟踪</td>
</tr>
<tr>
<td align="left">–log-dir</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果为非空，则在此目录中写入日志文件</td>
</tr>
<tr>
<td align="left">–log-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果为非空，使用此日志文件</td>
</tr>
<tr>
<td align="left">–log-file-max-size</td>
<td align="left">uint</td>
<td align="left">默认值：1800</td>
<td align="left">定义日志文件可以增长到的最大大小。单位为兆字节。 如果值为 0，则最大文件大小为无限制。</td>
</tr>
<tr>
<td align="left">–log-flush-frequency</td>
<td align="left">duration</td>
<td align="left">默认值：5s</td>
<td align="left">两次日志刷新之间的最大秒数</td>
</tr>
<tr>
<td align="left">–logging-format</td>
<td align="left">string</td>
<td align="left">默认值：”text”</td>
<td align="left">设置日志格式。允许的格式：”text”，”json”。非默认格式不支持以下标志：–add_dir_header、–alsologtostderr、–log_backtrace_at、–log_dir、–log_file、–log_file_max_size、–logtostderr、-skip_headers、-skip_log_headers、-stderrthreshold、-vmodule 和–log-flush-frequency。当前非默认选择为 alpha，并且会随时更改而不会发出警告。</td>
</tr>
<tr>
<td align="left">c –logtostderr</td>
<td align="left"></td>
<td align="left">默认值：true</td>
<td align="left">在标准错误而不是文件中输出日志记录</td>
</tr>
<tr>
<td align="left">–master-service-namespace</td>
<td align="left">string</td>
<td align="left">默认值：”default”</td>
<td align="left">已废弃：应该从其中将 Kubernetes 主服务注入到 Pod 中的名字空间。</td>
</tr>
<tr>
<td align="left">–max-connection-bytes-per-sec</td>
<td align="left">int</td>
<td align="left"></td>
<td align="left">如果不为零，则将每个用户连接限制为该数（字节数/秒）。 当前仅适用于长时间运行的请求。</td>
</tr>
<tr>
<td align="left">–max-mutating-requests-inflight</td>
<td align="left">int</td>
<td align="left">默认值：200</td>
<td align="left">在给定时间内进行中变更类型请求的最大个数。 当超过该值时，服务将拒绝所有请求。 零表示无限制。</td>
</tr>
<tr>
<td align="left">–max-requests-inflight</td>
<td align="left">int</td>
<td align="left">默认值：400</td>
<td align="left">在给定时间内进行中非变更类型请求的最大数量。 当超过该值时，服务将拒绝所有请求。 零表示无限制。</td>
</tr>
<tr>
<td align="left">–min-request-timeout</td>
<td align="left">int</td>
<td align="left">默认值：1800</td>
<td align="left">可选字段，表示处理程序在请求超时前，必须保持其处于打开状态的最小秒数。 当前只对监听（Watch）请求的处理程序有效，它基于这个值选择一个随机数作为连接超时值，以达到分散负载的目的。</td>
</tr>
<tr>
<td align="left">–oidc-ca-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果设置该值，将会使用 oidc-ca-file 中的机构之一对 OpenID 服务的证书进行验证， 否则将会使用主机的根 CA 对其进行验证。</td>
</tr>
<tr>
<td align="left">–oidc-client-id</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">OpenID 连接客户端的要使用的客户 ID，如果设置了 oidc-issuer-url，则必须设置这个值。</td>
</tr>
<tr>
<td align="left">–oidc-groups-claim</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果提供该值，这个自定义 OpenID 连接声明将被用来设定用户组。 该声明值需要是一个字符串或字符串数组。 此标志为实验性的，请查阅身份认证相关文档进一步了解详细信息。</td>
</tr>
<tr>
<td align="left">–oidc-groups-prefix</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果提供，则所有组都将以该值作为前缀，以防止与其他身份认证策略冲突。</td>
</tr>
<tr>
<td align="left">–oidc-issuer-url</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">OpenID 颁发者 URL，只接受 HTTPS 方案。 如果设置该值，它将被用于验证 OIDC JSON Web Token(JWT)。</td>
</tr>
<tr>
<td align="left">–oidc-required-claim</td>
<td align="left">mapStringString</td>
<td align="left"></td>
<td align="left">描述 ID 令牌中必需声明的键值对。 如果设置此值，则会验证 ID 令牌中存在与该声明匹配的值。 重复此标志以指定多个声明。</td>
</tr>
<tr>
<td align="left">–oidc-signing-algs</td>
<td align="left">stringSlice</td>
<td align="left">默认值：[RS256]</td>
<td align="left">允许的 JOSE 非对称签名算法的逗号分隔列表。 若 JWT 所带的 “alg” 标头值不在列表中，则该 JWT 将被拒绝。 取值依据 RFC 7518 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7518#section-3.1">https://tools.ietf.org/html/rfc7518#section-3.1</a> 定义。</td>
</tr>
<tr>
<td align="left">–oidc-username-claim</td>
<td align="left">string</td>
<td align="left">默认值：”sub”</td>
<td align="left">要用作用户名的 OpenID 声明。 请注意，除默认声明（”sub”）以外的其他声明不能保证是唯一且不可变的。 此标志是实验性的，请参阅身份认证文档以获取更多详细信息。</td>
</tr>
<tr>
<td align="left">–oidc-username-prefix</td>
<td align="left">string</td>
<td align="left">如果提供，则所有用户名都将以该值作为前缀。 如果未提供，则除 “email” 之外的用户名声明都会添加颁发者 URL 作为前缀，以避免冲突。 要略过添加前缀处理，请设置值为 “-“。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">–permit-port-sharing</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">如果为 true，则在绑定端口时将使用 SO_REUSEPORT， 这样多个实例可以绑定到同一地址和端口上。[默认值 = false]</td>
</tr>
<tr>
<td align="left">–profiling</td>
<td align="left"></td>
<td align="left">默认值：true</td>
<td align="left">通过 Web 界面启用性能分析 host:port/debug/pprof/</td>
</tr>
<tr>
<td align="left">–proxy-client-cert-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">当必须调用外部程序以处理请求时，用于证明聚合器或者 kube-apiserver 的身份的客户端证书。 包括代理转发到用户 api-server 的请求和调用 Webhook 准入控制插件的请求。 Kubernetes 期望此证书包含来自于 –requestheader-client-ca-file 标志中所给 CA 的签名。 该 CA 在 kube-system 命名空间的 “extension-apiserver-authentication” ConfigMap 中公开。 从 kube-aggregator 收到调用的组件应该使用该 CA 进行各自的双向 TLS 验证。</td>
</tr>
<tr>
<td align="left">–proxy-client-key-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">当必须调用外部程序来处理请求时，用来证明聚合器或者 kube-apiserver 的身份的客户端私钥。 这包括代理转发给用户 api-server 的请求和调用 Webhook 准入控制插件的请求。</td>
</tr>
<tr>
<td align="left">–request-timeout</td>
<td align="left">duration</td>
<td align="left">默认值：1m0s</td>
<td align="left">可选字段，指示处理程序在超时之前必须保持打开请求的持续时间。 这是请求的默认请求超时，但对于特定类型的请求，可能会被 –min-request-timeout 等标志覆盖。</td>
</tr>
<tr>
<td align="left">–requestheader-allowed-names</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">此值为客户端证书通用名称（Common Name）的列表；表中所列的表项可以用来提供用户名， 方式是使用 –requestheader-username-headers 所指定的头部。 如果为空，能够通过–requestheader-client-ca-file 中机构认证的客户端证书都是被允许的。</td>
</tr>
<tr>
<td align="left">–requestheader-client-ca-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">在信任请求头中以 –requestheader-username-headers 指示的用户名之前， 用于验证接入请求中客户端证书的根证书包。 警告：一般不要假定传入请求已被授权。</td>
</tr>
<tr>
<td align="left">–requestheader-extra-headers-prefix</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">用于查验请求头部的前缀列表。建议使用 X-Remote-Extra-。</td>
</tr>
<tr>
<td align="left">–requestheader-group-headers</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">用于查验用户组的请求头部列表。建议使用 X-Remote-Group。</td>
</tr>
<tr>
<td align="left">–requestheader-username-headers</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">用于查验用户名的请求头头列表。建议使用 X-Remote-User。</td>
</tr>
<tr>
<td align="left">–runtime-config</td>
<td align="left">mapStringString</td>
<td align="left"></td>
<td align="left">一组启用或禁用内置 API 的键值对。支持的选项包括：详情见官方文档</td>
</tr>
<tr>
<td align="left">–secure-port</td>
<td align="left">int</td>
<td align="left">默认值：6443</td>
<td align="left">带身份验证和鉴权机制的 HTTPS 服务端口。 不能用 0 关闭。</td>
</tr>
<tr>
<td align="left">–service-account-extend-token-expiration</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">在生成令牌时，启用投射服务帐户到期时间扩展， 这有助于从旧版令牌安全地过渡到绑定的服务帐户令牌功能。 如果启用此标志，则准入插件注入的令牌的过期时间将延长至 1 年，以防止过渡期间发生意外故障， 并忽略 service-account-max-token-expiration 的值。</td>
</tr>
<tr>
<td align="left">–service-account-issuer {service-account-issuer}/.well-known/openid-configuration</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">服务帐号令牌颁发者的标识符。 颁发者将在已办法令牌的 “iss” 声明中检查此标识符。 此值为字符串或 URI。 如果根据 OpenID Discovery 1.0 规范检查此选项不是有效的 URI，则即使特性门控设置为 true， ServiceAccountIssuerDiscovery 功能也将保持禁用状态。 强烈建议该值符合 OpenID 规范：<a target="_blank" rel="noopener" href="https://openid.net/specs/openid-connect-discovery-1_0.html%E3%80%82">https://openid.net/specs/openid-connect-discovery-1_0.html。</a> 实践中，这意味着 service-account-issuer 取值必须是 HTTPS URL。 还强烈建议此 URL 能够在 {service-account-issuer}/.well-known/openid-configuration 处提供 OpenID 发现文档。</td>
</tr>
<tr>
<td align="left">–service-account-jwks-uri</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">覆盖 /.well-known/openid-configuration 提供的发现文档中 JSON Web 密钥集的 URI。 如果发现文档和密钥集是通过 API 服务器外部 （而非自动检测到或被外部主机名覆盖）之外的 URL 提供给依赖方的，则此标志很有用。 仅在启用 ServiceAccountIssuerDiscovery 特性门控的情况下有效。</td>
</tr>
<tr>
<td align="left">–service-account-key-file</td>
<td align="left">stringArray</td>
<td align="left"></td>
<td align="left">包含 PEM 编码的 x509 RSA 或 ECDSA 私钥或公钥的文件，用于验证 ServiceAccount 令牌。 指定的文件可以包含多个键，并且可以使用不同的文件多次指定标志。 如果未指定，则使用 –tls-private-key-file。 提供 –service-account-signing-key 时必须指定。</td>
</tr>
<tr>
<td align="left">–service-account-lookup</td>
<td align="left"></td>
<td align="left">默认值：true</td>
<td align="left">如果为 true，则在身份认证时验证 etcd 中是否存在 ServiceAccount 令牌。</td>
</tr>
<tr>
<td align="left">–service-account-max-token-expiration</td>
<td align="left">duration</td>
<td align="left"></td>
<td align="left">服务帐户令牌发布者创建的令牌的最长有效期。 如果请求有效期大于此值的有效令牌请求，将使用此值的有效期颁发令牌。</td>
</tr>
<tr>
<td align="left">–service-account-signing-key-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含服务帐户令牌颁发者当前私钥的文件的路径。 颁发者将使用此私钥签署所颁发的 ID 令牌（需要启用 “TokenRequest” 特性门控）。</td>
</tr>
<tr>
<td align="left">–service-cluster-ip-range</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">CIDR 表示的 IP 范围用来为服务分配集群 IP。 此地址不得与指定给节点或 Pod 的任何 IP 范围重叠。</td>
</tr>
<tr>
<td align="left">–service-node-port-range</td>
<td align="left">portRange</td>
<td align="left">默认值：30000-32767</td>
<td align="left">保留给具有 NodePort 可见性的服务的端口范围。 例如：”30000-32767”。范围的两端都包括在内。</td>
</tr>
<tr>
<td align="left">–show-hidden-metrics-for-version</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">你要显示隐藏指标的先前版本。仅先前的次要版本有意义，不允许其他值。 格式为 <major>.<minor>，例如：”1.16”。 这种格式的目的是确保您有机会注意到下一个版本是否隐藏了其他指标， 而不是在此之后将它们从发行版中永久删除时感到惊讶。</td>
</tr>
<tr>
<td align="left">–shutdown-delay-duration</td>
<td align="left">duration</td>
<td align="left"></td>
<td align="left">延迟终止时间。在此期间，服务器将继续正常处理请求。 端点 /healthz 和 /livez 将返回成功，但是 /readyz 立即返回失败。 在此延迟过去之后，将开始正常终止。 这可用于允许负载平衡器停止向该服务器发送流量。</td>
</tr>
<tr>
<td align="left">–skip-headers</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">如果为 true，日志消息中避免标题前缀</td>
</tr>
<tr>
<td align="left">–skip-log-headers</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">如果为 true，则在打开日志文件时避免标题</td>
</tr>
<tr>
<td align="left">–stderrthreshold</td>
<td align="left">severity</td>
<td align="left">默认值：2</td>
<td align="left">将达到或超过此阈值的日志写到标准错误输出</td>
</tr>
<tr>
<td align="left">–storage-backend</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">持久化存储后端。选项：”etcd3”（默认）。</td>
</tr>
<tr>
<td align="left">–storage-media-type</td>
<td align="left">string</td>
<td align="left">默认值：”application/vnd.kubernetes.protobuf”</td>
<td align="left">用于在存储中存储对象的媒体类型。 某些资源或存储后端可能仅支持特定的媒体类型，并且将忽略此设置。</td>
</tr>
<tr>
<td align="left">–tls-cert-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含用于 HTTPS 的默认 x509 证书的文件。（CA 证书（如果有）在服务器证书之后并置）。 如果启用了 HTTPS 服务，并且未提供 –tls-cert-file 和 –tls-private-key-file， 为公共地址生成一个自签名证书和密钥，并将其保存到 –cert-dir 指定的目录中。</td>
</tr>
<tr>
<td align="left">–tls-cipher-suites</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">服务器的密码套件的列表，以逗号分隔。如果省略，将使用默认的 Go 密码套件。首选值：TLS_AES_128_GCM_SHA256、TLS_AES_256_GCM_SHA384、TLS_CHACHA20_POLY1305_SHA256、TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA、TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256、TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA、TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384、TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305、TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256、TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA、TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA、TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256、TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA、TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384、TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305、TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256、TLS_RSA_WITH_3DES_EDE_CBC_SHA、TLS_RSA_WITH_AES_128_CBC_SHA、TLS_RSA_WITH_AES_128_GCM_SHA256、TLS_RSA_WTLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256、TLS_ECDHE_ECDSA_WITH_RC4_128_SHA、TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256、TLS_ECDHE_RSA_WITH_RC4_128_SHA、TLS_RSA_WITH_AES_128_CBC_SHA256、TLS_RSA_WITH_RC4_128_SHA。</td>
</tr>
<tr>
<td align="left">–tls-min-version</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">支持的最低 TLS 版本。可能的值：VersionTLS10，VersionTLS11，VersionTLS12，VersionTLS13</td>
</tr>
<tr>
<td align="left">–tls-private-key-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">包含匹配 –tls-cert-file 的 x509 证书私钥的文件。</td>
</tr>
<tr>
<td align="left">–tls-sni-cert-key</td>
<td align="left">namedCertKey</td>
<td align="left">默认值：[]</td>
<td align="left">一对 x509 证书和私钥文件路径，（可选）后缀为全限定域名的域名模式列表，可以使用带有通配符的前缀。 域模式也允许使用 IP 地址，但仅当 apiserver 对客户端请求的 IP 地址具有可见性时，才应使用 IP。 如果未提供域模式，则提取证书的名称。 非通配符匹配优先于通配符匹配，显式域模式优先于提取出的名称。 对于多个密钥/证书对，请多次使用 –tls-sni-cert-key。 示例：”example.crt,example.key” 或 “foo.crt,foo.key:*.foo.com,foo.com”。</td>
</tr>
<tr>
<td align="left">–token-auth-file</td>
<td align="left">string</td>
<td align="left"></td>
<td align="left">如果设置该值，这个文件将被用于通过令牌认证来保护 API 服务的安全端口。</td>
</tr>
<tr>
<td align="left">-v, –v</td>
<td align="left">Level</td>
<td align="left"></td>
<td align="left">日志级别详细程度的数字</td>
</tr>
<tr>
<td align="left">–version version[=true]</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">打印版本信息并退出</td>
</tr>
<tr>
<td align="left">–vmodule</td>
<td align="left">moduleSpec</td>
<td align="left"></td>
<td align="left">以逗号分隔的 pattern=N 设置列表，用于文件过滤的日志记录</td>
</tr>
<tr>
<td align="left">–watch-cache</td>
<td align="left"></td>
<td align="left">默认值：true</td>
<td align="left">在 apiserver 中启用监视缓存</td>
</tr>
<tr>
<td align="left">–watch-cache-sizes</td>
<td align="left">stringSlice</td>
<td align="left"></td>
<td align="left">某些资源（pods、nodes 等）的监视缓存大小设置，以逗号分隔。 每个资源对应的设置格式：resource[.group]#size，其中 resource 为小写复数（无版本）， 对于 apiVersion v1（旧版核心 API）的资源要省略 group， 对其它资源要给出 group，size 为一个数字。 启用 watch-cache 时，此功能生效。 某些资源（replicationcontrollers、endpoints、nodes、pods、services、apiservices.apiregistration.k8s.io） 具有通过启发式设置的系统默认值，其他资源默认为 default-watch-cache-size</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/09/k8s-tools-kind-local-registry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/09/k8s-tools-kind-local-registry/" class="post-title-link" itemprop="url">k8s-kind-local-registry</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-09 15:07:54 / 修改时间：15:14:37" itemprop="dateCreated datePublished" datetime="2020-12-09T15:07:54+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="创建集群和本地仓库"><a href="#创建集群和本地仓库" class="headerlink" title="创建集群和本地仓库"></a>创建集群和本地仓库</h2><p>下面的shell脚本将创建一个本地docker仓库和一个启用它的kind集群。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">set -o errexit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> create registry container unless it already exists</span></span><br><span class="line">reg_name=&#x27;kind-registry&#x27;</span><br><span class="line">reg_port=&#x27;5000&#x27;</span><br><span class="line">running=&quot;$(docker inspect -f &#x27;&#123;&#123;.State.Running&#125;&#125;&#x27; &quot;$&#123;reg_name&#125;&quot; 2&gt;/dev/null || true)&quot;</span><br><span class="line">if [ &quot;$&#123;running&#125;&quot; != &#x27;true&#x27; ]; then</span><br><span class="line">  docker run \</span><br><span class="line">    -d --restart=always -p &quot;$&#123;reg_port&#125;:5000&quot; --name &quot;$&#123;reg_name&#125;&quot; \</span><br><span class="line">    registry:2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> create a cluster with the <span class="built_in">local</span> registry enabled <span class="keyword">in</span> containerd</span></span><br><span class="line">cat &lt;&lt;EOF | kind create cluster --config=-</span><br><span class="line">kind: Cluster</span><br><span class="line">apiVersion: kind.x-k8s.io/v1alpha4</span><br><span class="line">containerdConfigPatches:</span><br><span class="line">- |-</span><br><span class="line">  [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;localhost:$&#123;reg_port&#125;&quot;]</span><br><span class="line">    endpoint = [&quot;http://$&#123;reg_name&#125;:$&#123;reg_port&#125;&quot;]</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> connect the registry to the cluster network</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (the network may already be connected)</span></span><br><span class="line">docker network connect &quot;kind&quot; &quot;$&#123;reg_name&#125;&quot; || true</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Document the <span class="built_in">local</span> registry</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://github.com/kubernetes/enhancements/tree/master/keps/sig-cluster-lifecycle/generic/1755-communicating-a-local-registry</span></span><br><span class="line">cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: local-registry-hosting</span><br><span class="line">  namespace: kube-public</span><br><span class="line">data:</span><br><span class="line">  localRegistryHosting.v1: |</span><br><span class="line">    host: &quot;localhost:$&#123;reg_port&#125;&quot;</span><br><span class="line">    help: &quot;https://kind.sigs.k8s.io/docs/user/local-registry/&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="使用镜像库"><a href="#使用镜像库" class="headerlink" title="使用镜像库"></a>使用镜像库</h2><p>可以通过以下方式使用：</p>
<ul>
<li>首先拉取镜像：docker pull gcr.io/google-samples/hello-app:1.0</li>
<li>使用本地镜像库给镜像打tag： docker tag gcr.io/google-samples/hello-app:1.0 localhost:5000/hello-app:1.0</li>
<li>推送到本地镜像库：docker push localhost:5000/hello-app:1.0</li>
<li>使用镜像：kubectl create deployment hello-server –image=localhost:5000/hello-app:1.0</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/09/k8s-tools-kind-ingress/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/09/k8s-tools-kind-ingress/" class="post-title-link" itemprop="url">k8s-kind-ingress</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-09 10:24:07 / 修改时间：14:57:22" itemprop="dateCreated datePublished" datetime="2020-12-09T10:24:07+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Ingress-Controller"><a href="#Ingress-Controller" class="headerlink" title="Ingress Controller"></a>Ingress Controller</h2><p>在创建集群时，可以利用 KIND 的 extraPortMapping 配置选项，将端口从主机转发到运行在节点上的 ingress 控制器。</p>
<p>还可以通过在 kubeadm InitConfiguration 中使用节点标签来设置自定义节点标签，以便 ingress 控制器节点选择器使用。</p>
<ul>
<li><p>创建集群</p>
</li>
<li><p>部署 Ingress Controller，可以使用以下 ingress controllers：</p>
<ul>
<li>Ambassador</li>
<li>Contour</li>
<li>Ingress NGINX</li>
</ul>
</li>
</ul>
<h3 id="创建集群"><a href="#创建集群" class="headerlink" title="创建集群"></a>创建集群</h3><p>创建一个包含 extraPortMappings 和 node-labels 的 kind 集群。</p>
<ul>
<li><p>extraPortMappings：允许本地主机通过端口 80/443 向 Ingress controller 发出请求。</p>
</li>
<li><p>node-labels：只允许 ingress controller 运行在匹配标签选择器的指定节点上。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | kind create cluster --config=-</span><br><span class="line">kind: Cluster</span><br><span class="line">apiVersion: kind.x-k8s.io/v1alpha4</span><br><span class="line">nodes:</span><br><span class="line">- role: control-plane</span><br><span class="line">  kubeadmConfigPatches:</span><br><span class="line">  - |</span><br><span class="line">    kind: InitConfiguration</span><br><span class="line">    nodeRegistration:</span><br><span class="line">      kubeletExtraArgs:</span><br><span class="line">        node-labels: &quot;ingress-ready=true&quot;</span><br><span class="line">  extraPortMappings:</span><br><span class="line">  - containerPort: 80</span><br><span class="line">    hostPort: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">  - containerPort: 443</span><br><span class="line">    hostPort: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="Ambassador"><a href="#Ambassador" class="headerlink" title="Ambassador"></a>Ambassador</h3><p>Ambassador 可以在<a target="_blank" rel="noopener" href="https://www.getambassador.io/docs/latest/topics/install/aes-operator/">Ambassador operator</a>帮助下安装。</p>
<p>首先安装 CRDS：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://github.com/datawire/ambassador-operator/releases/latest/download/ambassador-operator-crds.yaml</span><br></pre></td></tr></table></figure>

<p>现在安装用于在 Ambassador 名称空间中使用操作符安装 Ambassador 的类型特定清单：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -n ambassador -f https://github.com/datawire/ambassador-operator/releases/latest/download/ambassador-operator-kind.yaml</span><br><span class="line">kubectl wait --timeout=180s -n ambassador --for=condition=deployed ambassadorinstallations/ambassador</span><br></pre></td></tr></table></figure>

<p>Ambassador 现在可以使用了。您现在可以尝试使用 Ingress 的示例，但是 Ambassador 不会自动加载那里定义的 Ingress。</p>
<p>Ingress class: 被认可为 Ambassador(否则不予理睬)。加载这个例子后，你可以添加这个注释:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl annotate ingress example-ingress kubernetes.io/ingress.class=ambassador</span><br></pre></td></tr></table></figure>

<h3 id="Contour"><a href="#Contour" class="headerlink" title="Contour"></a>Contour</h3><p>部署 Contour 组件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://projectcontour.io/quickstart/contour.yaml</span><br></pre></td></tr></table></figure>

<p>应用一种特定的补丁，以转发主机端口到 ingress controller，设置污染容忍和调度它到自定义标签节点。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;spec&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;template&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;spec&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;nodeSelector&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;ingress-ready&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;tolerations&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;node-role.kubernetes.io/master&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;operator&quot;</span>: <span class="string">&quot;Equal&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;effect&quot;</span>: <span class="string">&quot;NoSchedule&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure>

<p>通过运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl patch daemonsets -n projectcontour envoy -p &#x27;&#123;&quot;spec&quot;:&#123;&quot;template&quot;:&#123;&quot;spec&quot;:&#123;&quot;nodeSelector&quot;:&#123;&quot;ingress-ready&quot;:&quot;true&quot;&#125;,&quot;tolerations&quot;:[&#123;&quot;key&quot;:&quot;node-role.kubernetes.io/master&quot;,&quot;operator&quot;:&quot;Equal&quot;,&quot;effect&quot;:&quot;NoSchedule&quot;&#125;]&#125;&#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="Ingress-NGINX（已验证）"><a href="#Ingress-NGINX（已验证）" class="headerlink" title="Ingress NGINX（已验证）"></a>Ingress NGINX（已验证）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/provider/kind/deploy.yaml</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：镜像k8s.gcr.io/ingress-nginx/controller:v0.41.2@sha256:1f4f402b9c14f3ae92b11ada1dfe9893a88f0faeb0b2f4b903e2c67a0c3bf0de无法拉取，使用docker官网镜像acicn/ingress-nginx-controller:v0.41.2@sha256:8aa4fda472ec83ae59fe0ce9720684d769ed277ff9bdcbb0169178dc9d1f8e85替换。</p>
<p>这个清单包含了一些特定的补丁，用来将主机端口转发到 ingress controller，设置污染容限并将其调度到自定义标记的节点。</p>
<p>现在 Ingress 设置完成，等待，直到准备好处理正在运行的请求。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl wait --namespace ingress-nginx \</span><br><span class="line">  --for=condition=ready pod \</span><br><span class="line">  --selector=app.kubernetes.io/component=controller \</span><br><span class="line">  --timeout=90s</span><br></pre></td></tr></table></figure>

<h2 id="Using-Ingress"><a href="#Using-Ingress" class="headerlink" title="Using Ingress"></a>Using Ingress</h2><p>下面的例子是创建一个简单的 http-echo 服务和一个路由到这些服务的 Ingress 对象。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">foo-app</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">foo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo-app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hashicorp/http-echo:0.2.3</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;-text=foo&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">foo-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="comment"># Default port used by the image</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5678</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bar-app</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">bar</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">bar-app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hashicorp/http-echo:0.2.3</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;-text=bar&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bar-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">bar</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="comment"># Default port used by the image</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5678</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example-ingress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/foo</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">foo-service</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">5678</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/bar</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">bar-service</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">5678</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://kind.sigs.k8s.io/examples/ingress/usage.yaml</span><br></pre></td></tr></table></figure>

<p>现在验证Ingress是否工作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> should output <span class="string">&quot;foo&quot;</span></span></span><br><span class="line">curl localhost/foo</span><br><span class="line"><span class="meta">#</span><span class="bash"> should output <span class="string">&quot;bar&quot;</span></span></span><br><span class="line">curl localhost/bar</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/09/k8s-tools-kind-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/09/k8s-tools-kind-config/" class="post-title-link" itemprop="url">k8s-kind-config</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-09 09:15:55 / 修改时间：10:16:43" itemprop="dateCreated datePublished" datetime="2020-12-09T09:15:55+08:00">2020-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br></pre></td></tr></table></figure>

<h2 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h2><h3 id="Feature-Gates-特性开关"><a href="#Feature-Gates-特性开关" class="headerlink" title="Feature Gates(特性开关)"></a>Feature Gates(特性开关)</h3><p>可以通过以下配置启用所有 k8s 组件的 k8s 特性开关。</p>
<p>k8s 特性开关见 k8s-feature-gates 章节。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">featureGates:</span></span><br><span class="line">  <span class="comment"># any feature gate can be enabled here with &quot;Name&quot;: true</span></span><br><span class="line">  <span class="comment"># or disabled here with &quot;Name&quot;: false</span></span><br><span class="line">  <span class="comment"># not all feature gates are tested, however</span></span><br><span class="line">  <span class="attr">&quot;CSIMigration&quot;:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="Runtime-Config（运行时配置）"><a href="#Runtime-Config（运行时配置）" class="headerlink" title="Runtime Config（运行时配置）"></a>Runtime Config（运行时配置）</h3><p>k8s API server 运行时配置可以使用 runtimeconfig 进行配置。</p>
<p>k8s API server 运行时配置见 k8s-api-server 章节。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">runtimeConfig:</span></span><br><span class="line">  <span class="attr">&quot;api/alpha&quot;:</span> <span class="string">&quot;false&quot;</span> <span class="comment"># 禁用 api/alpha APIs</span></span><br></pre></td></tr></table></figure>

<h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><p>关于集群网络配置可以通过 networking 属性配置。</p>
<h4 id="IP-Family"><a href="#IP-Family" class="headerlink" title="IP Family"></a>IP Family</h4><p>Kind 可以支持 IP6 集群，你可以通过以下配置从 IP4 转换：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">ipFamily:</span> <span class="string">ipv6</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>： 为了使用这个功能，你需要修改 docker daemon 配置启用 ipv6。</p>
<h4 id="API-server"><a href="#API-server" class="headerlink" title="API server"></a>API server</h4><p>可以通过以下配置修改 API server 监听地址：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="comment"># WARNING: It is _strongly_ recommended that you keep this the default</span></span><br><span class="line">  <span class="comment"># (127.0.0.1) for security reasons. However it is possible to change this.</span></span><br><span class="line">  <span class="attr">apiServerAddress:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">  <span class="comment"># By default the API server listens on a random open port.</span></span><br><span class="line">  <span class="comment"># You may choose a specific port but probably don&#x27;t need to in most cases.</span></span><br><span class="line">  <span class="comment"># Using a random port makes it easier to spin up multiple clusters.</span></span><br><span class="line">  <span class="attr">apiServerPort:</span> <span class="number">6443</span></span><br></pre></td></tr></table></figure>

<h4 id="pod-subnet"><a href="#pod-subnet" class="headerlink" title="pod subnet"></a>pod subnet</h4><p>pod IPs 可以通过配置 subnet 进行设置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">podSubnet:</span> <span class="string">&quot;10.244.0.0/16&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="service-subnet"><a href="#service-subnet" class="headerlink" title="service subnet"></a>service subnet</h4><p>service IPs 可以通过配置 k8s service subnet 进行设置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">serviceSubnet:</span> <span class="string">&quot;10.96.0.0/12&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="Disable-Default-CNI"><a href="#Disable-Default-CNI" class="headerlink" title="Disable Default CNI"></a>Disable Default CNI</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="comment"># the default CNI will not be installed</span></span><br><span class="line">  <span class="attr">disableDefaultCNI:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="kube-proxy-mode"><a href="#kube-proxy-mode" class="headerlink" title="kube-proxy mode"></a>kube-proxy mode</h4><p>kube-proxy 模式可以通过配置 kube-proxy mode，包括 iptables 和 ipvs， 默认使用 iptables。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kind: Cluster</span><br><span class="line">apiVersion: kind.x-k8s.io/v1alpha4</span><br><span class="line">networking:</span><br><span class="line">  kubeProxyMode: <span class="string">&quot;ipvs&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Nodes"><a href="#Nodes" class="headerlink" title="Nodes"></a>Nodes</h3><p>kind：cluster 对象有 nodes 属性，包括一个 node 对象集合，如果不设置的话，默认是：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="comment"># one node hosting a control plane</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br></pre></td></tr></table></figure>

<p>可以通过以下配置创建多节点集群：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="comment"># One control plane node and three &quot;workers&quot;.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># While these will not add more real compute capacity and</span></span><br><span class="line"><span class="comment"># have limited isolation, this can be useful for testing</span></span><br><span class="line"><span class="comment"># rolling updates etc.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The API-server and other control plane components will be</span></span><br><span class="line"><span class="comment"># on the control-plane node.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You probably don&#x27;t need this unless you are testing Kubernetes itself.</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br></pre></td></tr></table></figure>

<p>可以通过指定一个 k8s 版本设置 node 容器镜像。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kindest/node:v1.16.4@sha256:b91a2c2317a000f3a783489dfb755064177dbc3a0b2f4147d50f04825d016f55</span></span><br></pre></td></tr></table></figure>

<h2 id="Pre-Node-Options"><a href="#Pre-Node-Options" class="headerlink" title="Pre-Node Options"></a>Pre-Node Options</h2><h3 id="Extra-Mounts"><a href="#Extra-Mounts" class="headerlink" title="Extra Mounts"></a>Extra Mounts</h3><p>Extra Mounts 可以用来通过主机上的存储传递到 kind 节点，以保存数据，通过代码挂载等等。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">    <span class="comment"># add a mount from /path/to/my/files on the host to /files on the node</span></span><br><span class="line">    <span class="attr">extraMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">hostPath:</span> <span class="string">/path/to/my/files/</span></span><br><span class="line">        <span class="attr">containerPath:</span> <span class="string">/files</span></span><br></pre></td></tr></table></figure>

<h3 id="Extra-Port-Mappings"><a href="#Extra-Port-Mappings" class="headerlink" title="Extra Port Mappings"></a>Extra Port Mappings</h3><p>可以使用额外的端口映射来转发到 kind 节点。这是一个跨平台的选择，让流量进入你的同类集群。</p>
<p>在 Linux 上使用 docker，您可以简单地将流量从主机发送到节点 IPs，而不需要它，但是要覆盖 macOS 和 Windows，您需要使用它们。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">    <span class="comment"># port forward 80 on the host to 80 on this node</span></span><br><span class="line">    <span class="attr">extraPortMappings:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">hostPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="comment"># optional: set the bind address on the host</span></span><br><span class="line">        <span class="comment"># 0.0.0.0 is the current default</span></span><br><span class="line">        <span class="attr">listenAddress:</span> <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">        <span class="comment"># optional: set the protocol to one of TCP, UDP, SCTP.</span></span><br><span class="line">        <span class="comment"># TCP is the default</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure>

<h3 id="Kubeadm-Config-Patches"><a href="#Kubeadm-Config-Patches" class="headerlink" title="Kubeadm Config Patches"></a>Kubeadm Config Patches</h3><p>Kind 可以使用 kubeadm 配置集群节点。kind 在第一个 control-plane 节点运行 kubeadm init, 以便它能够使用 kubeadm 进行配置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">    <span class="attr">kubeadmConfigPatches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line">        <span class="attr">kind:</span> <span class="string">InitConfiguration</span></span><br><span class="line">        <span class="attr">nodeRegistration:</span></span><br><span class="line">          <span class="attr">kubeletExtraArgs:</span></span><br><span class="line">            <span class="attr">node-labels:</span> <span class="string">&quot;my-label=true&quot;</span></span><br></pre></td></tr></table></figure>

<p>在 kind 集群配置的其他节点上，例如 worker 或者 control-plane (in HA mode）。kind 运行 kubeadm join，可以使用 JoinConfigration 配置。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line">    <span class="attr">kubeadmConfigPatches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line">        <span class="attr">kind:</span> <span class="string">JoinConfiguration</span></span><br><span class="line">        <span class="attr">nodeRegistration:</span></span><br><span class="line">          <span class="attr">kubeletExtraArgs:</span></span><br><span class="line">            <span class="attr">node-labels:</span> <span class="string">&quot;my-label2=true&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">    <span class="attr">kubeadmConfigPatches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">|</span></span><br><span class="line">        <span class="attr">kind:</span> <span class="string">JoinConfiguration</span></span><br><span class="line">        <span class="attr">nodeRegistration:</span></span><br><span class="line">          <span class="attr">kubeletExtraArgs:</span></span><br><span class="line">            <span class="attr">node-labels:</span> <span class="string">&quot;my-label3=true&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/08/k8s-tools-kind-knowledge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/08/k8s-tools-kind-knowledge/" class="post-title-link" itemprop="url">k8s-kind</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-08 10:10:38" itemprop="dateCreated datePublished" datetime="2020-12-08T10:10:38+08:00">2020-12-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-09 15:17:06" itemprop="dateModified" datetime="2020-12-09T15:17:06+08:00">2020-12-09</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://kind.sigs.k8s.io/docs">官方文档</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载</span></span><br><span class="line">wget -O kind -c https://kind.sigs.k8s.io/dl/v0.9.0/kind-linux-amd64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 赋予可执行</span></span><br><span class="line">chmod +x ./kind</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 移动到指令目录</span></span><br><span class="line">mv ./kind /usr/local/bin/kind</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">kind -h</span><br></pre></td></tr></table></figure>

<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建集群</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建集群后，会自动生成~/.kube/config文件</span></span><br><span class="line">kind create cluster [--config  config.yaml]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看创建集群帮助文档</span></span><br><span class="line">kind create cluster --help</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询集群</span></span><br><span class="line">kind get clusters</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除集群</span></span><br><span class="line">kind delete cluster [--name xxx]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加载镜像</span></span><br><span class="line">kind load docker-image my-custom-image --name kind</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看集群节点镜像</span></span><br><span class="line">docker exec -it my-node-name crictl images</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建镜像</span></span><br><span class="line">kind build node-image [--type bazel|docker]</span><br></pre></td></tr></table></figure>

<h2 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h2><h3 id="配置kind集群"><a href="#配置kind集群" class="headerlink" title="配置kind集群"></a>配置kind集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind create cluster --config kind-example-config.yaml</span><br></pre></td></tr></table></figure>

<ul>
<li>多节点集群</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># three node (two workers) cluster config</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">networking:</span></span><br><span class="line">  <span class="attr">apiServerAddress:</span> <span class="string">&quot;192.168.56.101&quot;</span> <span class="comment"># 配置集群网络地址</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br></pre></td></tr></table></figure>

<img src="/2020/12/08/k8s-tools-kind-knowledge/multi-node-cluster.png" class="" title="多节点集群">

<ul>
<li>控制层高可用集群</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a cluster with 3 control-plane nodes and 3 workers</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">worker</span></span><br></pre></td></tr></table></figure>

<img src="/2020/12/08/k8s-tools-kind-knowledge/control-plane-ha-cluster.png" class="" title="控制层高可用集群">

<ul>
<li>宿主机端口映射</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kind.x-k8s.io/v1alpha4</span></span><br><span class="line"><span class="attr">nodes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">role:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">extraPortMappings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">hostPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">listenAddress:</span> <span class="string">&quot;0.0.0.0&quot;</span> <span class="comment"># Optional, defaults to &quot;0.0.0.0&quot;</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">tcp</span> <span class="comment"># Optional, defaults to tcp</span></span><br></pre></td></tr></table></figure>

<img src="/2020/12/08/k8s-tools-kind-knowledge/host-port-mapping-cluster.png" class="" title="宿主机端口映射">

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/08/k8s-tools-kubectl-knowledge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/08/k8s-tools-kubectl-knowledge/" class="post-title-link" itemprop="url">k8s-kubectl</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-08 09:33:14 / 修改时间：10:11:16" itemprop="dateCreated datePublished" datetime="2020-12-08T09:33:14+08:00">2020-12-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载</span></span><br><span class="line">wget -c &quot;https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 赋予可执行</span></span><br><span class="line">chmod +x ./kubectl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 移动到指令目录</span></span><br><span class="line">sudo mv ./kubectl /usr/local/bin/kubectl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">kubectl version --client</span><br></pre></td></tr></table></figure>

<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/07/k8s-component-knowledge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/07/k8s-component-knowledge/" class="post-title-link" itemprop="url">k8s-组件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-07 16:06:00 / 修改时间：21:26:11" itemprop="dateCreated datePublished" datetime="2020-12-07T16:06:00+08:00">2020-12-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="k8s-组件"><a href="#k8s-组件" class="headerlink" title="k8s 组件"></a>k8s 组件</h2><p>下图是一个包含所有组件的 k8s 集群组件图：</p>
<img src="/2020/12/07/k8s-component-knowledge/components-of-kubernetes.svg" class="" title="k8s集群组件">

<h3 id="控制层组件"><a href="#控制层组件" class="headerlink" title="控制层组件"></a>控制层组件</h3><p>控制层组件执行集群全局决策（例如：调度），并且发现和响应集群事件（例如：当部署副本数不够时启动一个新的容器）。</p>
<p>控制层组件可以在集群上的任意一台机器上运行。然而，通常情况下，将所有控制层组件部署在同一台机器上，但是这台机器不运行用户容器。</p>
<h4 id="kube-apiserver"><a href="#kube-apiserver" class="headerlink" title="kube-apiserver"></a>kube-apiserver</h4><p>API server 是 k8s 控制层暴露 k8s API 的组件。API server 是 k8s 控制层的前端。</p>
<p>k8s API 的主要实现是 kube-apiserver。kube-apiserver 被设计成横向扩展，就是，通过部署更多实例进行扩展。你可以通过运行几个 kube-apiserver 实例，以实现实例间的负载均衡。</p>
<h4 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a>etcd</h4><p>作为 k8s 备份存储集群数据的一致性、高可用键值对数据库。</p>
<p>如果 k8s 集群采用 etcd 作为备份存储，请确保您有一个备份这些数据的计划。</p>
<h4 id="kube-scheduler"><a href="#kube-scheduler" class="headerlink" title="kube-scheduler"></a>kube-scheduler</h4><p>控制层组件为新的容器查找未分配的节点，并且从中选择一个节点运行容器。</p>
<p>考虑调度决策的因素包括：个人和组织的资源申请，硬件、软件和政策约束，亲和力和抗亲和力规范，数据本地化，网络负载干扰和最后期限等。</p>
<h4 id="kube-controller-manager"><a href="#kube-controller-manager" class="headerlink" title="kube-controller-manager"></a>kube-controller-manager</h4><p>运行控制器进程的控制层组件。</p>
<p>理论上，每个控制器都是一个独立的进程，但是为了降低复杂性，它们被编译成单个二进制文件，并在单个进程中运行。</p>
<p>控制器包括：</p>
<ul>
<li>节点控制器（node controller）：负责发现和响应节点宕机</li>
<li>副本控制器（replication controller）：负责为系统中的每个复制控制器对象维护正确的 pods 数量</li>
<li>端点控制器（Endpoint controller）：填充端点对象(即连接 Services 和 Pods)</li>
<li>服务帐户和令牌控制器（Service Account &amp; Token controllers）：为新的命名空间创建默认帐户和 API 访问令牌</li>
</ul>
<h4 id="cloud-controller-manager"><a href="#cloud-controller-manager" class="headerlink" title="cloud-controller-manager"></a>cloud-controller-manager</h4><p>一个嵌入特定云控制逻辑的 k8s 控制层组件。云控制器管理器允许您将集群链接到云提供商的 API 中，并将与云平台交互的组件和仅与集群交互的组件分离开来。</p>
<p>云控制器-管理器只运行特定云提供商的控制器。如果在自己的服务器上运行 k8s，或者在自己的 PC 内的学习环境中运行，那么集群没有云控制器管理器。</p>
<p>与 kube-controller-manager 一样，cloud-controller-manager 将几个逻辑上独立的控制器整合到单个二进制文件中，可以将其作为单个进程运行。可以水平扩展(运行多个副本)以提高性能或帮助容忍失败。</p>
<p>以下控制器可以具有云提供商依赖关系：</p>
<ul>
<li>节点控制器（node controller）：用于检查云提供商，以确定一个节点在停止响应后是否已在云中删除</li>
<li>路由控制器（Route controller）：用于在底层云基础设施中设置路由</li>
<li>服务控制器（Service controller）：用于创建、更新和删除云提供商负载平衡器</li>
</ul>
<h3 id="节点组件"><a href="#节点组件" class="headerlink" title="节点组件"></a>节点组件</h3><p>节点组件在每个节点上运行，负责维护和提供 k8s 运行环境。</p>
<h4 id="kubelet"><a href="#kubelet" class="headerlink" title="kubelet"></a>kubelet</h4><p>一个运行在集群每个节点上的代理。它确保容器在 Pod 中运行。</p>
<p>kubelet 采用了一组通过各种机制提供的 PodSpecs，并确保这些 PodSpecs 中描述的容器运行正常。kubelet 不管理不是由 k8s 创建的容器。</p>
<h4 id="kube-proxy"><a href="#kube-proxy" class="headerlink" title="kube-proxy"></a>kube-proxy</h4><p>kube-proxy 是一个运行在集群每个节点上的网络代理,是实现 k8s Service 概念的一部分。</p>
<p>kube-proxy 维护节点上的网络规则。这些网络规则允许从集群内部或外部的网络会话与 Pods 进行网络通信。kube-proxy 使用操作系统包过滤层(如果有并且可用的话），否则，kube-proxy 将自己转发流量。</p>
<h4 id="Container-runtime"><a href="#Container-runtime" class="headerlink" title="Container runtime"></a>Container runtime</h4><p>Container runtime 是负责运行容器的软件。</p>
<p>k8s 支持几种 Container runtime：Docker、containerd, CRI-O 和任何 k8s CRI（Container Runtime Interface）实现。</p>
<h3 id="Addons"><a href="#Addons" class="headerlink" title="Addons"></a>Addons</h3><p>插件使用k8s资源(守护进程、部署等)来实现集群特性。因为它们提供了集群级别的特性，所以插件的名称空间资源属于kube-system名称空间。</p>
<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>虽然其他插件不是严格要求的，但所有k8s集群都应该有集群DNS，因为许多示例依赖于它。</p>
<p>集群DNS是您环境中的其他DNS服务器之外的一个DNS服务器，它为k8s service提供DNS记录。</p>
<p>由k8s启动的容器在其DNS搜索中自动包含此DNS服务器。</p>
<h4 id="Web-UI-Dashboard"><a href="#Web-UI-Dashboard" class="headerlink" title="Web UI (Dashboard)"></a>Web UI (Dashboard)</h4><p>仪表板是一种用于k8s集群的通用的、基于web的UI。它允许用户管理并排除集群中运行的应用程序以及集群本身的故障。</p>
<h4 id="Container-Resource-Monitoring"><a href="#Container-Resource-Monitoring" class="headerlink" title="Container Resource Monitoring"></a>Container Resource Monitoring</h4><p>Container Resource Monitoring在一个中央数据库中记录关于容器的一般时间序列指标，并提供一个用于浏览该数据的UI。</p>
<h4 id="Cluster-level-Logging"><a href="#Cluster-level-Logging" class="headerlink" title="Cluster-level Logging"></a>Cluster-level Logging</h4><p>集群级日志记录机制负责将容器日志保存到具有搜索/浏览界面的中央日志存储区。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/06/virtualbox-centos-network/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/06/virtualbox-centos-network/" class="post-title-link" itemprop="url">虚拟机网络配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-06 19:45:51" itemprop="dateCreated datePublished" datetime="2020-12-06T19:45:51+08:00">2020-12-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-07 14:48:37" itemprop="dateModified" datetime="2020-12-07T14:48:37+08:00">2020-12-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/virtual-box/" itemprop="url" rel="index"><span itemprop="name">virtual-box</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Host-Network（宿主机网络）"><a href="#Host-Network（宿主机网络）" class="headerlink" title="Host Network（宿主机网络）"></a>Host Network（宿主机网络）</h2><p>创建一个新的宿主机网络，并启用,步骤如下：</p>
<p>VirtualBox：File –&gt; Host Network Manager –&gt; create –&gt; Enable</p>
<table>
<thead>
<tr>
<th align="center">Name</th>
<th align="center">IP4 Address/Mask</th>
<th align="center">IP4 Address/Mask</th>
<th align="center">DHCP Server</th>
</tr>
</thead>
<tbody><tr>
<td align="center">vboxnet0</td>
<td align="center">192.168.56.1/24</td>
<td align="center"></td>
<td align="center">Enable</td>
</tr>
</tbody></table>
<h2 id="虚拟机网络"><a href="#虚拟机网络" class="headerlink" title="虚拟机网络"></a>虚拟机网络</h2><p>虚拟机：Network配置</p>
<ul>
<li>Adapter1<ul>
<li>Attached To –&gt; <strong>NET</strong></li>
</ul>
</li>
<li>Adapter2<ul>
<li>Attached To –&gt; <strong>Host-only Adapter</strong></li>
<li>Name–&gt; <strong>vboxnet0</strong></li>
</ul>
</li>
</ul>
<h2 id="网络配置文件"><a href="#网络配置文件" class="headerlink" title="网络配置文件"></a>网络配置文件</h2><p>配置/etc/sysconfig/network-scripts/ifcfg-enp0s3</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=enp0s3</span><br><span class="line">UUID=b21ea777-2443-4c8e-9554-4b6882ef4a85</span><br><span class="line">DEVICE=enp0s3</span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure>

<p>配置/etc/sysconfig/network-scripts/ifcfg-enp0s8</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=enp0s8</span><br><span class="line">UUID=008d2e0e-fd8a-41dc-9009-92bc8820f31d</span><br><span class="line">DEVICE=enp0s8</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.56.101</span><br><span class="line">NETMASK=255.255.255.0</span><br></pre></td></tr></table></figure>

<p>配置/etc/sysconfig/network</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Created by anaconda</span><br><span class="line">NETWORKING=yes</span><br></pre></td></tr></table></figure>

<p>重启虚拟机</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/06/python-module-itertools-knowledge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/06/python-module-itertools-knowledge/" class="post-title-link" itemprop="url">内置模块-itertools</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-12-06 15:15:50 / 修改时间：19:37:18" itemprop="dateCreated datePublished" datetime="2020-12-06T15:15:50+08:00">2020-12-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="无穷迭代器"><a href="#无穷迭代器" class="headerlink" title="无穷迭代器"></a>无穷迭代器</h2><p>itertools.count(start, step)</p>
<ul>
<li>start：起点</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianqiuzhifeng.github.io/2020/12/04/python-tutorial-knowledge-four/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="浅秋之枫">
      <meta itemprop="description" content="随堂笔记">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浅秋之枫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/12/04/python-tutorial-knowledge-four/" class="post-title-link" itemprop="url">数据类型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-12-04 13:22:27" itemprop="dateCreated datePublished" datetime="2020-12-04T13:22:27+08:00">2020-12-04</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-12-07 16:05:29" itemprop="dateModified" datetime="2020-12-07T16:05:29+08:00">2020-12-07</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><p>对象 是 Python 中对数据的抽象。 Python 程序中的所有数据都是由对象或对象间关系来表示的。 （从某种意义上说，按照冯·诺依曼的“存储程序计算机”模型，代码本身也是由对象来表示的。）</p>
<p>每个对象都有各自的编号、类型和值。一个对象被创建后，它的 编号 就绝不会改变；你可以将其理解为该对象在内存中的地址。 ‘is’ 运算符可以比较两个对象的编号是否相同；id() 函数能返回一个代表其编号的整型数。</p>
<p>有些对象的<strong>值</strong>可以改变。值可以改变的对象被称为<strong>可变的</strong>；值不可以改变的对象就被称为<strong>不可变的</strong>。(一个不可变容器对象如果包含对可变对象的引用，当后者的值改变时，前者的值也会改变；但是该容器仍属于不可变对象，因为它所包含的对象集是不会改变的。因此，不可变并不严格等同于值不能改变，实际含义要更微妙。) 一个对象的可变性是由其类型决定的；例如，数字、字符串和元组是不可变的，而字典和列表是可变的。</p>
<h2 id="内置类型"><a href="#内置类型" class="headerlink" title="内置类型"></a>内置类型</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">浅秋之枫</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  







  






</body>
</html>
